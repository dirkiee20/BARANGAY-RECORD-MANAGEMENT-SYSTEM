<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Barangay RMS Â· Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
  <style>
    /* Style for address cells to prevent long text from breaking layout */
    .address-cell {
      max-width: 200px; /* Adjust as needed */
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: help; /* Indicates that more information is available on hover */
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">
        <img src="{{ url_for('static', filename='img/logo.webp') }}" alt="BRMS Logo" class="logo-img">
      </div>
      <div class="brand-text">
        <h1>Barangay</h1>
        <p>Record Management</p>
      </div>
    </div>
    <nav class="nav">
      <a href="/dashboard" class="nav-link active">Dashboard</a>
      <a href="/residents" class="nav-link">Residents</a>
      <a href="/households" class="nav-link">Households</a>
      <a href="/blotter" class="nav-link">Blotter</a>
      <a href="/clearances" class="nav-link">Clearances</a>
      <a href="officials" class="nav-link">Officials</a>
      <a href="/reports" class="nav-link">Reports</a>
      <div class="spacer"></div>
      <a href="{{ url_for('auth.logout') }}" class="nav-link danger">Logout</a>
    </nav>
  </aside>

  <main class="main">
    <header class="topbar">
      <h2>Dashboard</h2>
      <div class="topbar-actions">
        <div class="search-container">
          <input class="search" type="search" placeholder="Search residents, records..." autocomplete="off" />
          <div id="searchResults" class="search-results"></div>
        </div>
        <button class="btn" onclick="dashboardManager.handleRefresh(event)">ðŸ”„ Refresh</button>
        <button class="btn primary" id="newRecordBtn">New Record</button>
      </div>
    </header>

    <section class="stats">
      <div class="stat-card">
        <div class="stat-label">Total Residents</div>
        <div class="stat-value">{{ data.stats.total_residents }}</div>
        <div class="stat-sub">+{{ data.stats.new_residents_week }} this week</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Households</div>
        <div class="stat-value">{{ data.stats.total_households }}</div>
        <div class="stat-sub">+{{ data.stats.new_households_week }} this week</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Active Blotters</div>
        <div class="stat-value warning">{{ data.stats.active_blotters }}</div>
        <div class="stat-sub">{{ data.stats.blotters_due_today }} due today</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Clearances Issued</div>
        <div class="stat-value">{{ data.stats.clearances_issued_month }}</div>
        <div class="stat-sub">Last 30 days</div>
      </div>
    </section>

    <section class="grid">
      <div class="panel">
        <div class="panel-header">
          <h3>Recent Residents</h3>
          <button class="btn">View all</button>
        </div>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Address</th>
                <th>Age</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for resident in data.recent_residents %}
              <tr>
                <td>{{ resident.first_name }} {{ resident.last_name }}</td>
                <td class="address-cell" title="{{ resident.address }}">{{ resident.address }}</td>
                <td>{{ resident.age }}</td>
                <td><span class="badge success">{{ resident.status }}</span></td>
                <td class="actions">
                  <button class="icon-btn">â‹¯</button>
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="5" style="text-align: center; color: var(--muted);">No residents found</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <h3>Open Blotters</h3>
          <button class="btn">View all</button>
        </div>
        <ul class="list">
          {% for blotter in data.open_blotters %}
          <li>
            <div>
              <div class="list-title">{{ blotter.case_title }}</div>
              <div class="list-sub">
                {% if blotter.reported_by %}
                  Reported by: {{ blotter.reported_by.first_name }} {{ blotter.reported_by.last_name }}
                {% else %}
                  Reported by: Anonymous
                {% endif %}
                {% if blotter.location %} Â· {{ blotter.location }}{% endif %}
              </div>
            </div>
            <span class="badge warning">
              {% if blotter.hearing_date and blotter.hearing_date.date() == data.today %}
                Due today
              {% else %}
                Open
              {% endif %}
            </span>
          </li>
          {% else %}
          <li>
            <div>
              <div class="list-title">No Open Cases</div>
              <div class="list-sub">All cases are currently resolved</div>
            </div>
            <span class="badge success">Good!</span>
          </li>
          {% endfor %}
        </ul>
      </div>

      <div class="panel">
        <div class="panel-header">
          <h3>Clearance Requests</h3>
          <button class="btn">Manage</button>
        </div>
        <ul class="list">
          <li>
            <div>
              <div class="list-title">Barangay Clearance</div>
              <div class="list-sub">Pending: {{ data.clearance_summary.pending }} Â· Processed today: {{ data.clearance_summary.processed_today }}</div>
            </div>
            {% if data.clearance_summary.pending > 0 %}
              <span class="badge info">Pending</span>
            {% else %}
              <span class="badge success">All Clear</span>
            {% endif %}
          </li>
          <li>
            <div>
              <div class="list-title">Indigency Certificate</div>
              <div class="list-sub">Pending: {{ data.clearance_summary.pending }} Â· Processed today: {{ data.clearance_summary.processed_today }}</div>
            </div>
            {% if data.clearance_summary.processed_today > 0 %}
              <span class="badge success">On track</span>
            {% else %}
              <span class="badge">No activity</span>
            {% endif %}
          </li>
        </ul>
      </div>
    </section>
  </main>

  <!-- New Record Modal -->
  <div id="newRecordModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create New Record</h3>
        <span class="close" id="closeModal">&times;</span>
      </div>
      
      <form id="newRecordForm" class="form">
        <div class="form-group">
          <label for="recordType">Record Type *</label>
          <select id="recordType" name="recordType" required>
            <option value="">Select Record Type</option>
          </select>
        </div>

        <!-- Resident Form Fields -->
        <div id="residentFields" class="record-fields" style="display: none;">
          <div class="resident-form-layout">
            <div class="profile-column">
              <div class="profile-uploader">
                <input type="file" id="profilePicture" name="profilePicture" accept="image/*" style="display: none;">
                <img src="{{ url_for('static', filename='img/no-profile.webp') }}" alt="Profile Preview" id="profilePreview">
                <div class="upload-instructions">
                  <p>Click or drag to upload</p>
                </div>
              </div>
              <div class="form-group">
                <label for="birthDate">Birth Date</label>
                <input type="date" id="birthDate" name="birthDate">
              </div>
              <div class="form-group">
                <label for="sex">Sex</label>
                <select id="sex" name="sex">
                  <option value="">Select</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>
              <div class="form-group">
                <label for="citizenship">Citizenship</label>
                <input type="text" id="citizenship" name="citizenship">
              </div>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label for="firstName">First Name *</label>
                <input type="text" id="firstName" name="firstName" required>
              </div>
              <div class="form-group">
                <label for="middleName">Middle Name</label>
                <input type="text" id="middleName" name="middleName">
              </div>
              <div class="form-group">
                <label for="lastName">Last Name *</label>
                <input type="text" id="lastName" name="lastName" required>
              </div>
              <div class="form-group">
                <label for="alias">Alias</label>
                <input type="text" id="alias" name="alias">
              </div>
              <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email">
              </div>
              <div class="form-group">
                <label for="contactNumber">Contact Number</label>
                <input type="tel" id="contactNumber" name="contactNumber">
              </div>
              <div class="form-group">
                <label for="placeOfBirth">Place of Birth</label>
                <input type="text" id="placeOfBirth" name="placeOfBirth">
              </div>
              <div class="form-group">
                <label for="civilStatus">Civil Status</label>
                <select id="civilStatus" name="civilStatus">
                  <option value="">Select Status</option>
                  <option value="Single">Single</option>
                  <option value="Married">Married</option>
                  <option value="Widowed">Widowed</option>
                  <option value="Separated">Separated</option>
                </select>
              </div>
              <div class="form-group">
                <label for="purok">Purok</label>
                <input type="text" id="purok" name="purok">
              </div>
              <div class="form-group">
                <label for="votersStatus">Voter's Status</label>
                <select id="votersStatus" name="votersStatus">
                  <option value="">Select Status</option>
                  <option value="Registered">Registered</option>
                  <option value="Not Registered">Not Registered</option>
                </select>
              </div>
              <div class="form-group">
                <label for="identifiedAs">Identified As</label>
                <input type="text" id="identifiedAs" name="identifiedAs">
              </div>
              <div class="form-group">
                <label for="occupation">Occupation</label>
                <input type="text" id="occupation" name="occupation">
              </div>
              <div class="form-group full">
                <label for="address">Address *</label>
                <input type="text" id="address" name="address" required>
              </div>
            </div>
          </div>
        </div>

        <!-- Household Form Fields -->
        <div id="householdFields" class="record-fields" style="display: none;">
          <div class="form-grid">
            <div class="form-group">
              <label for="headId">Head of Family *</label>
              <select id="headId" name="headId" required>
                <option value="">Select a resident...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="householdCategory">Household Category</label>
              <select id="householdCategory" name="category">
                <option value="">Select Category</option>
                <option value="Regular">Regular</option>
                <option value="Single Parent">Single Parent</option>
                <option value="Senior Headed">Senior Headed</option>
                <option value="With PWD">With PWD</option>
              </select>
            </div>
            <div class="form-group full">
              <label for="householdAddress">Address *</label>
              <input type="text" id="householdAddress" name="address" required placeholder="Block, Lot, Street...">
            </div>
            <div class="form-group">
              <label for="householdPurok">Purok/Zone</label>
              <input type="text" id="householdPurok" name="purok">
            </div>
            <div class="form-group">
              <label for="monthlyIncome">Monthly Income (â‚±)</label>
              <input type="number" id="monthlyIncome" name="monthlyIncome" step="0.01" placeholder="e.g., 15000.00">
            </div>
            <div class="form-group">
              <label for="toiletType">Toilet Type</label>
              <select id="toiletType" name="toiletType">
                <option value="">Select Type</option>
                <option value="Water-sealed">Water-sealed</option>
                <option value="Antipolo">Antipolo</option>
                <option value="None">None</option>
              </select>
            </div>
            <div class="form-group full">
              <label for="householdRemarks">Remarks</label>
              <textarea id="householdRemarks" name="remarks" rows="2"></textarea>
            </div>
          </div>
        </div>

        <!-- Blotter Form Fields -->
        <div id="blotterFields" class="record-fields" style="display: none;">
          <div class="form-grid">
            <div class="form-group full">
              <label for="caseTitle">Case Title *</label>
              <input type="text" id="caseTitle" name="caseTitle" required>
            </div>
            <div class="form-group">
              <label for="caseType">Case Type</label>
              <select id="caseType" name="caseType">
                <option value="">Select Case Type</option>
                <option value="Dispute">Dispute</option>
                <option value="Complaint">Complaint</option>
                <option value="Violation">Violation</option>
                <option value="Request">Request</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="location">Location</label>
              <input type="text" id="location" name="location">
            </div>
            <div class="form-group full">
              <label for="details">Case Details *</label>
              <textarea id="details" name="details" rows="4" required></textarea>
            </div>
            <div class="form-group">
              <label for="respondentName">Respondent Name</label>
              <input type="text" id="respondentName" name="respondentName">
            </div>
          </div>
        </div>

        <!-- Clearance Form Fields -->
        <div id="clearanceFields" class="record-fields" style="display: none;">
          <div class="form-grid">
            <div class="form-group">
              <label for="clearanceType">Clearance Type *</label>
              <select id="clearanceType" name="clearanceType" required>
                <option value="">Select Clearance Type</option>
                <option value="Barangay Clearance">Barangay Clearance</option>
                <option value="Indigency Certificate">Indigency Certificate</option>
                <option value="Good Moral Character">Good Moral Character</option>
                <option value="Residency Certificate">Residency Certificate</option>
                <option value="Business Permit">Business Permit</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="purpose">Purpose *</label>
              <input type="text" id="purpose" name="purpose" required>
            </div>
            <div class="form-group full">
              <label for="residentId">Resident *</label>
              <select id="residentId" name="residentId" required>
                <option value="">Select Resident</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn secondary" onclick="dashboardManager.hideNewRecordModal()">Cancel</button>
          <button type="submit" class="btn primary">Create Record</button>
        </div>
      </form>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
  <script>
    // Placeholder for future interactivity
  </script>
</body>
</html>
